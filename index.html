<html>
<head>
<title>Widevine test #1</title>
<script src="https://cdn.dashjs.org/latest/dash.all.debug.js"></script>
<script>
function init(serverURL) {
    var protData = {
        "com.widevine.alpha": {
            "serverURL": serverURL,
            priority: 0
        }
    };
    var video,
        player,
        url = "https://video.gumlet.io/655243edfc21dc1b6b763c4c/655497fd3699cbd2c01e369c/main.mpd";

    video = document.querySelector("video");
    player = dashjs.MediaPlayer().create();
    player.initialize(video, url, false);

    /*player.updateSettings({
            'streaming': {
                'abr': {
                    'maxBitrate': {
                        'video': 3000000 // Set maximum bitrate (adjust as needed)
                    }
                }
            }
        });*/
    
    player.setQualityFor(720);
    player.setProtectionData(protData);
}

function check() {
    if (location.protocol === 'http:' && location.hostname !== 'localhost') {
        var out = 'This page has been loaded under http. This might result in the EME APIs not being available to the player and any DRM-protected content will fail to play. ' +
            'If you wish to test manifest URLs that require EME support, then <a href=\'https:' + window.location.href.substring(window.location.protocol.length) + '\'>reload this page under https</a>.'
        var div = document.getElementById('http-warning');
        div.innerHTML = out;
        div.style.display = ''
    }
}

async function fetchAndGo() {
    const response = await fetch('https://worker-white-moon-c279.gilles-7b1.workers.dev/');
    const serverURL = await response.text();
    console.log(serverURL);
    check();
    init(serverURL.trim());
}
</script>
</head>
<body>
  <video id="videoPlayer" controls></video>
  <div id="http-warning"></div>
  <script>
      document.addEventListener('DOMContentLoaded', fetchAndGo);
  </script>
</body>
</html>
